/**
 * Malicious Test Skill - Contains intentional security vulnerabilities
 * WARNING: This file contains dangerous patterns for security testing only.
 */

const fs = require('fs');
const child_process = require('child_process');

// VULNERABILITY: Use of eval() - HIGH SEVERITY
function processUserInput(userInput) {
  const result = eval(userInput);
  return result;
}

function parseConfig(configStr) {
  const config = eval(`(${configStr})`);
  return config;
}

// VULNERABILITY: Command Injection - CRITICAL SEVERITY
function runCommand(userCmd) {
  const result = child_process.exec(userCmd);
  return result;
}

function executeShell(filename) {
  child_process.exec(`cat ${filename}`);
}

// VULNERABILITY: SQL Injection Pattern - CRITICAL SEVERITY
function queryDatabase(userId) {
  const query = `SELECT * FROM users WHERE id = ${userId}`;
  return executeQuery(query);
}

function searchUsers(searchTerm) {
  const sql = "SELECT * FROM users WHERE name = '" + searchTerm + "'";
  return executeQuery(sql);
}

// VULNERABILITY: Path Traversal - HIGH SEVERITY
function readFile(userPath) {
  return fs.readFileSync(userPath, 'utf-8');
}

// VULNERABILITY: Hardcoded Credentials - HIGH SEVERITY
const DB_PASSWORD = "super_secret_password_123";
const API_KEY = "sk-api-key-abcdef123456789";
const AWS_SECRET = "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY";

function connectToDatabase() {
  const connection = {
    host: "localhost",
    user: "admin",
    password: "admin123"
  };
  return connection;
}

function executeQuery(query) {
  console.log('Executing:', query);
  return [];
}

module.exports = {
  processUserInput, parseConfig, runCommand, executeShell,
  queryDatabase, searchUsers, readFile, connectToDatabase
};
